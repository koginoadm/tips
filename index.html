# START ########################################################
cat <<'__COMMENT__'
<link rel="stylesheet" href="./css/vs2015.css"><script src="./js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><style>body{font-size:0;margin:0}.monospaced{font-size:1rem;font-family:"Osaka－等幅",Consolas,"Courier New",Courier,monospace}</style><div><pre><code class="monospaced"># curl http://djeeno.info/

#### vars ####
declare -a        ftp_data_port=(    20/tcp                     )
declare -a     ftp_control_port=(    21/tcp                     )
declare -a             ssh_port=(    22/tcp                     )
declare -a          telnet_port=(    23/tcp                     )
declare -a            smtp_port=(    25/tcp                     )
declare -a smtp_submission_port=(   587/tcp                     )
declare -a           smtps_port=(   465/tcp                     )
declare -a            pop3_port=(   110/tdp                     )
declare -a           pop3s_port=(   995/tcp                     )
declare -a            imap_port=(   143/tdp                     )
declare -a           imaps_port=(   993/tcp                     )
declare -a             dns_port=(    53/tcp    53/udp           )
declare -a            dhcp_port=(    67/udp    68/udp           )
declare -a            http_port=(    80/tcp                     )
declare -a           https_port=(   443/tcp                     )
declare -a            quic_port=(    80/udp   443/udp           )
declare -a        kerberos_port=(    88/tcp    88/udp           )
declare -a             ntp_port=(   123/udp                     )
declare -a         netbios_port=(   137/udp   138/udp   139/tcp )
declare -a            snmp_port=(   161/udp                     )
declare -a        snmptrap_port=(   162/tcp   162/udp           )
declare -a             bgp_port=(   179/tcp                     )
declare -a             irc_port=(   194/tcp   194/udp           )
declare -a            ldap_port=(   389/tcp                     )
declare -a           ldaps_port=(   636/tcp                     )
declare -a             smb_port=(   445/tcp                     )
declare -a          syslog_port=(   514/udp                     )
declare -a           iscsi_port=(   860/tcp                     )
declare -a           mssql_port=(  1433/tcp                     )
declare -a           mysql_port=(  3306/tcp                     )
declare -a      postgresql_port=(  5432/tcp                     )
declare -a             nfs_port=(  2049/tcp  2049/udp           )
declare -a             rdp_port=(  3389/tcp                     )
declare -a         jenkins_port=(  8080/tcp                     )
declare -a          gitlab_port=(  8080/tcp                     )
declare -a    zabbix_agent_port=( 10050/tcp                     )
declare -a   zabbix_server_port=( 10051/tcp                     )

#### bash ####
[ "$(id -u)" -eq 0 ] && PS1='\[\033[01;31m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ ' || PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
find ./ -type f -exec chmod 644 {} \;
find ./ -type d -exec chmod 755 {} \;
echo "$(cat /dev/urandom | tr -dc '[:alnum:]' | head -c 16)"
echo 172.16.1.{0..255} | xargs -P256 -n1 ping -s1 -c1 -W1 | \grep ttl | sort -V
for i in {0..255}; do printf "%3d: $(tput setaf $i)$(date -Is)$(tput sgr0)\n" $i; done

#### *nix ####
vipw
vigr
visudo -f /etc/sudoers.d/admin
ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
timedatectl set-timezone Asia/Tokyo

#### CentOS ####
curl http://djeeno.info/ROOT/etc/sysconfig/network-scripts/ifcfg-tmp

#### alias ####
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias crontab='crontab -i'
alias l='ls -CF'
alias la='ls -A'
alias ll='ls -alF'
alias ls='ls --color=auto'
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'

#### systemctl ####
systemctl list-unit-files

#### SELinux ####
grep -q '^SELINUX=enforcing' /etc/selinux/config && { setenforce 0; sed 's/^\(SELINUX=\)\(enforcing\)/#\1\2\n\1disabled/g' $_ -i_$(date +%Y%m%d_%H%M%S).backup }

#### Update Package Repository Database ####
apt update
yum makecache fast

#### install ####
apt -y install dnsutils perl unzip vim whois zip
yum -y install bind-utils perl unzip vim whois zip
curl -LR https://bootstrap.pypa.io/get-pip.py | python
pip install speedtest-cli
pip install awscli
apt -y install fuse && curl -LR https://github.com/kahing/goofys/releases/download/v0.0.18/goofys -o /usr/bin/goofys && chmod 755 $_
yum -y install fuse && curl -LR https://github.com/kahing/goofys/releases/download/v0.0.18/goofys -o /usr/bin/goofys && chmod 755 $_
curl -LR https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64 -o /usr/bin/jq && chmod +x $_

#### ntp ####
ntpdate -v ntp.nict.jp
chronyc sources
chronyc makestep

#### apache ####
httpd -h #help
httpd -l #Output a list of modules compiled into the server.
httpd -L #Output a list of directives provided by static modules.
httpd -M #Dump a list of loaded Static and Shared Modules.
httpd -S #Show the settings as parsed from the config file.
httpd -t #Run syntax tests for configuration files only.
httpd -v #Print the version of httpd.
httpd -V #Print the version and build parameters of httpd.
curl http://djeeno.info/apache/ssl_rewrite.conf

#### esxi ####
ls -l /etc/ssh/keys-root/authorized_keys

#### ssh ####
curl https://koginoadm.github.io/keys
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAmHliNKOjmnRCG4gdntmF30witZpGtCK7CdfnsohSexd0WgNWragj9aQepsrG6Dvzy6D060KttD6p/htFbnj7fqMsKS58ZLdfuFSUdKSG6GawZ608Hbw+nI79Tx768YAklGIL4cY4Q24fgq6hqBpYZd7n344c4GSBp4eqQj+1eCp8KfeE60HXb0sGUsJb9BlTMJMlHpyKMLhjq5/7yPrWye/n5OKvEEYb1qdrNpZ7FvVmkEj3ibxriMUYOpUrze4qYkVAXd/WD6FqASv3/hXv/7MIfOryhtO1k1xIB8Hks9H7xg7waDMXxjK5BDqvkSMR72Dm4pcZMm6eAsF4Rzf6Ew== https://koginoadm.github.io/keys' | tee -a ~/.ssh/authorized_keys
echo | ssh-keygen -N ""
[ -d ~/.ssh ] || echo | ssh-keygen -t rsa -N "" -f ~/.ssh/tmp && \rm -f ~/.ssh/tmp{,.pub}
(curl https://koginoadm.github.io/keys | tee -a ~/.ssh/authorized_keys) && chmod 600 $_

#### appendix ####
curl checkip.amazonaws.com
curl ipinfo.io

#### mariadb-server on CentOS7 ####
rpm -q mariadb-server || (
yum -y install mariadb-server
test -f /etc/my.cnf.d/server.cnf && mv $_ ${_}_$(date +%Y%m%d_%H%M%S).backup
cp -p /usr/share/mysql/my-small.cnf /etc/my.cnf.d/server.cnf
grep 'default-character-set = utf8' /etc/my.cnf.d/server.cnf || sed 's@\(\[client\]\)@\1\ndefault-character-set = utf8'"$(date +'# %Y%m%d #')"'@g;' -i /etc/my.cnf.d/server.cnf
grep 'character-set-server = utf8'  /etc/my.cnf.d/server.cnf || sed 's@\(\[mysqld\]\)@\1\ncharacter-set-server = utf8'"$(date +'# %Y%m%d #')"'@g;'  -i /etc/my.cnf.d/server.cnf
systemctl enable mariadb
systemctl start mariadb
[[ -r ~/.my.cnf ]] || echo -e '[client]\nuser = root\npassword = "'$(cat /dev/urandom | tr -dc '[:alnum:]' | head -c 16)'"' >> ~/.my.cnf
mysql -u root --password= -e "
    UPDATE mysql.user SET Password=PASSWORD('$(grep ^password ~/.my.cnf | sed 's/^password = .\([a-zA-Z0-9]\+\)./\1/g')') WHERE User='root';
    DELETE FROM mysql.user WHERE User='';
    DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
    DROP DATABASE test;
    DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';
    FLUSH PRIVILEGES;"
)

#### zabbix-server on CentOS7 ####
rpm -q mariadb-server zabbix-server-mysql || [ ! -f ~/.my.cnf ] || (
yum -y install yum-utils http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm
yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-web-japanese
yum -y install zabbix-agent
yum -y install zabbix-get
yum-config-manager --disable zabbix zabbix-non-supported
[[ -r ~/.my.cnf.zabbix ]] || echo -e '[client]\nuser = zabbix\npassword = "'$(cat /dev/urandom | tr -dc '[:alnum:]' | head -c 16)'"' >> ~/.my.cnf.zabbix
mysql -u root -e "
    CREATE DATABASE IF NOT EXISTS zabbix CHARACTER SET utf8 COLLATE utf8_bin;
    GRANT ALL PRIVILEGES ON zabbix.* TO 'zabbix'@'localhost' IDENTIFIED BY '$(grep ^password ~/.my.cnf.zabbix | sed 's/^password = .\([a-zA-Z0-9]\+\)./\1/g')';
    FLUSH PRIVILEGES;"
zcat /usr/share/doc/zabbix-server-mysql-3.4.*/create.sql.gz | mysql --defaults-file=~/.my.cnf.zabbix -u zabbix zabbix
sed 's/\(# \)\(DBPassword=\)/\1\2\n\2'$(grep ^password ~/.my.cnf.zabbix | sed 's/^password = .\([a-zA-Z0-9]\+\)./\1/g')'/g;' -i /etc/zabbix/zabbix_server.conf
sed "s@^\( *\)\(# \)\(php_value date.timezone \)\(Europe/Riga\)@\1\2\3\4\n\1\3Asia/Tokyo@g" -i /etc/httpd/conf.d/zabbix.conf
systemctl restart httpd
systemctl enable zabbix-server
systemctl start zabbix-server
systemctl enable zabbix-agent
systemctl start zabbix-agent
firewall-cmd --permanent --add-service http && firewall-cmd --reload
)

#### frequently used ####
_file=
cp -pr ${_file:?}{,_$(date +%Y%m%d_%H%M%S).backup} && ls -l ${_file}_*.backup
egrep -v '^[[:space:]]*#|^[[:space:]]*$' ${_file:?}



# written by <a href="https://github.com/koginoadm">@koginoadm</a></code></pre></div>
__COMMENT__
# END ##########################################################
